@using SEN381_UI.Data
@using SEN381_UI.Shared.MockData
@page "/Policy/{id}"

<MudCard style="max-height:1000px; overflow: auto;">
    <MudCardHeader>
        <CardHeaderContent>
            <MudText Typo="Typo.h5" Align="Align.Center">Policy Details</MudText>
        </CardHeaderContent>
        <CardHeaderAvatar>
            <MudIconButton Icon="@Icons.Filled.KeyboardBackspace"></MudIconButton>
        </CardHeaderAvatar>
    </MudCardHeader>
    <MudForm Class="p-5">
            <MudGrid>
            @*Policy Basic Details*@
                <MudItem xs="6" sm="6">
                     <MudTextField T="string" Label="Policy ID" ReadOnly="true" Text="@id"></MudTextField>
                </MudItem>
                 <MudItem xs="6" sm="6">
                     <MudTextField T="string" Label="Policy Status" ReadOnly="true" @bind-status=status Text="@status"></MudTextField>
                 </MudItem>
                 <MudItem xs="12" sm="6">
                      <MudTextField T="string" Label="Place Of Treatment" @bind-status=placeOfTreatment Text="@placeOfTreatment"></MudTextField>
                 </MudItem>
                <MudItem xs="12" sm="6">
                    <MudDateRangePicker Label="Policy Availability Dates" @bind-DateRange="_dateRange"></MudDateRangePicker>
                </MudItem>

                    @*Treatment Coverage Details*@
                <MudItem xs="6" sm="6">
                    <MudExpansionPanel class="h-25" Text="Policy Packages">

                    <MudExpansionPanels style="max-height:400px; overflow: auto;" class="accordion-body">
                        @foreach (Package package in packages)
                        {
                            string text = $"Package ID:{@package.PackageID}";
                            <MudExpansionPanel Text="@text">
                                @foreach (TreatmentCoverage item in package.TreatmentCoverages)
                                {
                                    
                                    <MudCard class="mt-2 p-2">
                                        <MudGrid>
                                            <MudItem xs="9">
                                                <MudText Align="Align.Center"> Treatment: @item.Treatment.TreatmentName </MudText>
                                                <MudText Align="Align.Center"> Coverage Level: @item.Coverage.CoverageDescription </MudText>
                                            </MudItem>
                                            <MudItem xs="3">
                                                <MudText Align="Align.Center">
                                                    <MudButton>
                                                        <MudIcon Icon="@Icons.Filled.Delete" Color="Color.Error"></MudIcon>
                                                    </MudButton>
                                                </MudText>
                                            </MudItem>
                                        </MudGrid>
                                        
                                        
                                    </MudCard>

                                }
                                        
                            </MudExpansionPanel>
                            
                        }
                        </MudExpansionPanels>
                    </MudExpansionPanel>
                </MudItem>
                @*Client Details *@
                <MudItem xs="6" sm="6">
                    <MudExpansionPanel class="h-25" Text="Policy Client Details">

                        <MudExpansionPanels style="max-height:400px; overflow: auto;" class="accordion-body">
                            @foreach (Client client in clients)
                            {
                                string text = $"Client ID: {@client.clientID}";
                                <MudExpansionPanel Text="@text">
                                    <MudText> Client Name: @client.ClientName </MudText>
                                    <MudText> Client Surname: @client.ClientSurname </MudText>      
                                </MudExpansionPanel>

                            }
                        </MudExpansionPanels>
                    </MudExpansionPanel>
                </MudItem>

                        @*Performance Details To be Implemented Later*@
                        @*<MudItem xs="12" sm="6">
                            <MudExpansionPanel class="h-25" Text="Policy Performance Details">

                            </MudExpansionPanel>
                        </MudItem>*@
                <MudItem xs="6" sm="6">
                    <MudButton>Cancel Changes</MudButton>
                </MudItem>
                <MudItem xs="6" sm="6">
                    <MudButton>Save Changes</MudButton>
                </MudItem>
            </MudGrid>
    </MudForm>

</MudCard>


@code {

    [Parameter]
    public string? id { get; set; }

    string status = "Active";
    string placeOfTreatment = "St Georges";

    List<Package> packages = new PackageMock().getPackages();//Replace with service
    List<Client> clients = new ClientMock().GetClients();//Replace with service

    private DateRange _dateRange = new DateRange(DateTime.Now.Date, DateTime.Now.AddDays(5).Date);//Used for date picker
}
